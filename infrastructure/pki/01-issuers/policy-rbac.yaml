---
# ClusterRole allowing use of the step-ca certificate request policy
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRole
metadata:
  name: approve-step-ca-requests:use
rules:
  - apiGroups:
      - policy.cert-manager.io
    resources:
      - certificaterequestpolicies
    verbs:
      - use
    resourceNames:
      - approve-step-ca-requests
---
# ClusterRoleBinding for cert-manager to use the policy
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRoleBinding
metadata:
  name: cert-manager:approve-step-ca-requests
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: ClusterRole
  name: approve-step-ca-requests:use
subjects:
  # Bind to cert-manager service account
  - kind: ServiceAccount
    name: cert-manager-cert-manager
    namespace: cert-manager
