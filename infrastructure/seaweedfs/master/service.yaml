---
# Headless service for SeaweedFS Master StatefulSet
# Creates stable DNS names for each Master pod:
#   master-0.master.seaweedfs.svc.cluster.local
#   master-1.master.seaweedfs.svc.cluster.local
#   master-2.master.seaweedfs.svc.cluster.local
# These DNS names are used for Raft peer discovery and communication
apiVersion: v1
kind: Service
metadata:
  name: master
  namespace: seaweedfs
  labels:
    app.kubernetes.io/name: seaweedfs
    app.kubernetes.io/component: master
spec:
  # clusterIP: None makes this a "headless" service
  # Instead of load balancing, DNS returns all pod IPs
  # StatefulSet uses this for stable network identity
  clusterIP: None

  selector:
    app.kubernetes.io/name: seaweedfs
    app.kubernetes.io/component: master

  ports:
    - name: master
      port: 9333
      targetPort: 9333
      protocol: TCP

  # publishNotReadyAddresses allows DNS to work even if pods aren't ready yet
  # Important for Raft cluster formation (chicken-egg: need DNS to become ready)
  publishNotReadyAddresses: true
---
# Regular service for client access to Masters
# Load balances requests across all healthy Master pods
# Clients use this to ask "where should I upload my file?"
apiVersion: v1
kind: Service
metadata:
  name: master-client
  namespace: seaweedfs
  labels:
    app.kubernetes.io/name: seaweedfs
    app.kubernetes.io/component: master
spec:
  type: ClusterIP

  selector:
    app.kubernetes.io/name: seaweedfs
    app.kubernetes.io/component: master

  ports:
    - name: master
      port: 9333
      targetPort: 9333
      protocol: TCP
